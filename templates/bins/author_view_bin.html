{% load static %}

<!-- –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –±—ñ–Ω (–∑–ª—ñ–≤–∞) -->
<div class="col-md-7">
    <div class="d-flex align-items-center mb-3">
        <img src="{% if bin.author and bin.author.image %}{{ bin.author.image.url }}{% else %}{% static 'deps/images/baseavatar.jpg' %}{% endif %}" alt="avatar" class="rounded-circle me-3" width="56" height="56">
        <div>
            <h2 class="mb-0">{{ bin.title|default:"–ë–µ–∑ –Ω–∞–∑–≤–∏" }}</h2>
            <div class="text-white small">
                <a href="#" class="fw-bold text-decoration-none user-dropdown-green">@{{ bin.author.username|default:"–ì—ñ—Å—Ç—å" }}</a>
                &bull; {{ bin.created_at|date:"d.m.Y H:i" }}
                &bull; –ü–µ—Ä–µ–≥–ª—è–¥—ñ–≤: {{ bin.views_count|default:"0" }}
                &bull; –ß–∞—Å —ñ—Å–Ω—É–≤–∞–Ω–Ω—è: {{ bin.created_at|timesince }} —Ç–æ–º—É
            </div>
        </div>
    </div>
    <div class="d-flex align-items-center mb-2">
        <span class="badge btn-logo me-2" style="border:2px solid #43e97b;color:#43e97b;background:#181c20;font-size:1em;padding:0.3em 0.8em;">{{ bin.get_language_display }}</span>
        <span class="text-white me-2">–†–æ–∑–º—ñ—Ä: {{ bin.size_bin|filesizeformat }} B</span>
        <button class="btn btn-logo btn-sm me-2" style="font-size:1em;padding:0.2em 0.7em;" id="like-btn">üëç {{ bin.likes|default:"0" }}</button>
        <button class="btn btn-logo btn-sm me-2" style="font-size:1em;padding:0.2em 0.7em;" id="dislike-btn">üëé {{ bin.dislikes|default:"0" }}</button>
        <button class="btn btn-logo btn-sm me-2" style="font-size:1em;padding:0.2em 0.7em;" id="copy-btn">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <button class="btn btn-logo btn-sm" style="font-size:1em;padding:0.2em 0.7em;" id="share-btn">URL</button>
    </div>
    <div class="code-block mb-3">
        <pre><code class="language-{{ bin.language|default:'plaintext' }}">{{ bin_content|escape }}</code></pre>
    </div>
    <div class="mb-3">
        <h5 class="mb-2">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h5>
        <form method="post" action="#" class="d-flex mt-2" id="comment-form">
            {% csrf_token %}
            <input type="text" name="text" class="form-control me-2" placeholder="–ó–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä..." required>
            <button type="submit" class="btn btn-logo">–î–æ–¥–∞—Ç–∏</button>
        </form>
        <div id="comment-messages"></div>
        <div id="comments-list" class="mt-3">
            {% for comment in comments %}
                <div class="border rounded p-2 mb-2 card bg-dark">
                    <b class="user-dropdown-green">{{ comment.author.username }}:</b>
                    <span class="text-white small">{{ comment.text }}</span>
                    <span class="text-white small">({{ comment.created_at|timesince }} —Ç–æ–º—É)</span>
                </div>
            {% empty %}
                <div class="text-white">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —â–µ –Ω–µ–º–∞—î.</div>
            {% endfor %}
        </div>
    </div>
</div>
<!-- –ü–∞–Ω–µ–ª—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω (—Å–ø—Ä–∞–≤–∞) -->
<div class="col-md-5">
    <div class="p-4 mb-4 rounded custom-shadow" style="background-color: #23272b;">
        <h4 class="text-center mb-4">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è Bin</h4>
        <form method="post" action="{% url 'bins:edit_bin' bin.id %}">
            {% csrf_token %}
            <div class="mb-3">
                <label for="id_title" class="form-label">–ù–∞–∑–≤–∞ Bin</label>
                <input type="text" class="form-control" id="id_title" 
                name="title" 
                value="{{ form.title.value }}"
                required>
                {% if form.title.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.title.errors }}</div>
                {% endif %}
            </div>
            <div class="mb-3">
                <label for="id_content" class="form-label">–ö–æ–Ω—Ç–µ–Ω—Ç</label>
                <textarea class="form-control autosize" id="id_content" 
                name="content" rows="2">{{ bin_content }}</textarea>
                {% if form.content.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.content.errors }}</div>
                {% endif %}
            </div>
            <div class="mb-3">
                <label for="id_category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                <select name="category" class="form-select" id="id_category">
                    {% for value, label in category_choices %}
                        <option value="{{ value }}" {% if form.category.value == value %}selected{% endif %} >{{ label }}</option>
                    {% endfor %}
                </select>
                {% if form.category.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.category.errors }}</div>
                {% endif %}
            </div>
            <div class="mb-3">
                <label for="id_language" class="form-label">–ú–æ–≤–∞</label>
                <select name="language" class="form-select" id="id_language">
                    {% for value, label in language_choices %}
                        <option value="{{ value }}" {% if form.language.value == value %}selected{% endif %} >{{ label }}</option>
                    {% endfor %}
                </select>
                {% if form.language.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.language.errors }}</div>
                {% endif %}
            </div>
            <div class="mb-3">
                <label for="id_expiry" class="form-label">–¢–µ—Ä–º—ñ–Ω –¥—ñ—ó</label>
                <select name="expiry" class="form-select" id="id_expiry">
                    {% for value, label in expiry_choices %}
                        <option value="{{ value }}" {% if form.expiry.value == value %}selected{% endif %} >{{ label }}</option>
                    {% endfor %}
                </select>
                {% if form.expiry.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.expiry.errors }}</div>
                {% endif %}
            </div>
            <div class="mb-3">
                <label for="id_access" class="form-label">–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å</label>
                <select name="access" class="form-select" id="id_access">
                    {% for value, label in access_choices %}
                        <option value="{{ value }}" {% if form.access.value == value %}selected{% endif %} >{{ label }}</option>
                    {% endfor %}
                </select>
                {% if form.access.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.access.errors }}</div>
                {% endif %}
            </div>
            <div class="mb-3">
                <label for="id_tags" class="form-label">–¢–µ–≥–∏</label>
                <input type="text" class="form-control" id="id_tags" 
                name="tags" 
                value="{{ form.tags.value }}">
                {% if form.tags.errors %}
                    <div class="alert alert-danger alert-dismissible fade show">{{ form.tags.errors }}</div>
                {% endif %}
            </div>
            <button type="submit" class="btn btn-success w-100">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
        </form>
        <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
        <form method="post" action="{% url 'bins:delete_bin' bin.id %}" class="mt-3" onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ Bin?');">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger w-100">–í–∏–¥–∞–ª–∏—Ç–∏ Bin</button>
        </form>
    </div>
</div>